(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.length=e,this.ship=this.createShip()}var n,r;return n=t,(r=[{key:"createShip",value:function(){for(var e=[],t=this.length;t>0;)e.push({hit:!1}),t--;return e}},{key:"getShip",value:function(){return this.ship}},{key:"getShipLength",value:function(){return this.ship.length}},{key:"hit",value:function(e){this.ship[e].hit=!0}},{key:"checkHit",value:function(e){return 1==e.hit}},{key:"isSunk",value:function(){return!!this.ship.every(this.checkHit)}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameBoardArray=this.createGameBoard(),this.missedAttacks=[]}var t,r;return t=e,(r=[{key:"createGameBoard",value:function(){for(var e=[],t=[],n=0;n<10;n++){for(var r=0;r<10;r++)t.push({shipName:void 0,shipIndex:void 0});e.push(t),t=[]}return e}},{key:"getGameBoard",value:function(){return this.gameBoardArray}},{key:"chechIfShipPlacementIsValid",value:function(e,t,n){if(t>10||t<0||n>10||n<0||n+e>10)return!1;for(var r=n;r<n+e;r++)if(null!=this.gameBoardArray[r][t].shipName)return!1;return!0}},{key:"placeShip",value:function(e,t,n){if(this.chechIfShipPlacementIsValid(e.getShipLength(),t,n))for(var r=0;r<e.getShipLength();r++)this.gameBoardArray[n+r][t].shipName=e,this.gameBoardArray[n+r][t].shipIndex=r}},{key:"receiveAttack",value:function(e,t){null==this.gameBoardArray[t][e].shipName?this.missedAttacks.push({x:e,y:t}):this.gameBoardArray[t][e].shipName.hit(this.gameBoardArray[t][e].shipIndex)}},{key:"getMissedAttacksArray",value:function(){return this.missedAttacks}},{key:"checkIfAllShipSunk",value:function(){var e=!0;return this.gameBoardArray.forEach((function(t){t.forEach((function(t){t.shipName&&0==t.shipName.isSunk()&&(e=!1)}))})),e}}])&&n(t.prototype,r),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.turn=!0}var t,n;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"endTurn",value:function(e){1==this.turn&&(this.turn=!1,e.startTurn())}},{key:"startTurn",value:function(){0==this.turn&&(this.turn=!0)}},{key:"checkTurn",value:function(){return this.turn}},{key:"attack",value:function(e,t,n,r){this.checkTurn()&&(r.receiveAttack(e,t),this.endTurn(n))}}])&&a(t.prototype,n),e}();function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function l(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,a,o=(r=i,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=s(r);if(a){var n=s(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function i(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this,e,n)).turn=!1,r.enemyPlayer=t,r.enemyBoard=n,r.attackArray=[],r}return t=i,(n=[{key:"generateRandomAttack",value:function(){var e=this;this.checkTurn()&&function(){for(var t={x:void 0,y:void 0};;){var n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());if(t.x=n,t.y=r,!e.attackArray.some((function(e){return e.x==t.x&&e.y==t.y}))){e.attackArray.push(t),e.attack(t.x,t.y,e.enemyPlayer,e.enemyBoard);break}}}()}},{key:"getAttackArray",value:function(){return this.attackArray}}])&&c(t.prototype,n),i}(o),f=document.querySelector("#battleship"),d=document.querySelector("#carrier"),y=document.querySelector("#submarine"),p=document.querySelector("#destroyer"),m=document.querySelector("#patrolboat"),v=document.querySelector(".addShips"),g=document.querySelector(".aiSide"),k=document.querySelector("#modal"),S=document.querySelector("#nameInput"),b=document.querySelector("#modalContent"),A=document.querySelector("#playerName"),w=(document.querySelector("#endGameContent"),document.querySelector("#endGameModal")),B=document.querySelector("#playAgainButton"),x=document.querySelector("#winnerText"),I=new t(5),q=new t(4),N=new t(3),E=new t(3),P=new t(2),C=new t(5),T=new t(4),L=new t(3),O=new t(3),j=new t(2),M=new r,R=new r,V=new o("Kuzuha"),_=new h("AI",V,M);function D(e){for(;;){var t;if(t=[Math.floor(10*Math.random()),Math.floor(10*Math.random())],R.chechIfShipPlacementIsValid(e.getShipLength(),t[0],t[1])){R.placeShip(e,t[0],t[1]);break}}}function G(e){e.addEventListener("dragstart",(function(e){e.dataTransfer.setData("text/plain",e.target.id)}))}function H(e){var t=e.dataTransfer.getData("text"),n=parseInt(e.target.getAttribute("data-x")),r=parseInt(e.target.getAttribute("data-y"));switch(t){case"battleship":if(M.chechIfShipPlacementIsValid(q.length,n,r)){M.placeShip(q,n,r),K("playerBoard",M);var a=document.querySelector("#".concat(t));v.removeChild(a),v.childNodes.length<=6&&(v.style.display="none",g.style.display="flex")}break;case"carrier":if(M.chechIfShipPlacementIsValid(I.length,n,r)){M.placeShip(I,n,r),K("playerBoard",M);var o=document.querySelector("#".concat(t));v.removeChild(o),v.childNodes.length<=6&&(v.style.display="none",g.style.display="flex")}break;case"submarine":if(M.chechIfShipPlacementIsValid(E.length,n,r)){M.placeShip(E,n,r),K("playerBoard",M);var i=document.querySelector("#".concat(t));v.removeChild(i),v.childNodes.length<=6&&(v.style.display="none",g.style.display="flex")}break;case"destroyer":if(M.chechIfShipPlacementIsValid(N.length,n,r)){M.placeShip(N,n,r),K("playerBoard",M);var c=document.querySelector("#".concat(t));v.removeChild(c),v.childNodes.length<=6&&(v.style.display="none",g.style.display="flex")}break;case"patrolboat":if(M.chechIfShipPlacementIsValid(P.length,n,r)){M.placeShip(P,n,r),K("playerBoard",M);var u=document.querySelector("#".concat(t));v.removeChild(u),v.childNodes.length<=6&&(v.style.display="none",g.style.display="flex")}}}function X(e){for(var t=document.querySelector(".".concat(e)),n=0;n<10;n++)for(var r=0;r<10;r++){var a=document.createElement("div");a.classList.add("cell"),a.setAttribute("data-x",r),a.setAttribute("data-y",n),"aiBoard"==e?a.addEventListener("click",(function(e){var t,n,r;t=e.target,n=t.getAttribute("data-x"),r=t.getAttribute("data-y"),V.attack(n,r,_,R),K("aiBoard",R),t.style.pointerEvents="none",R.checkIfAllShipSunk()&&z(V.getName()),_.generateRandomAttack(),K("playerBoard",M),M.checkIfAllShipSunk()&&z("AI")})):"playerBoard"==e&&(a.addEventListener("dragover",(function(e){e.preventDefault()})),a.addEventListener("drop",(function(e){e.preventDefault(),H(e)}))),t.appendChild(a)}}function z(e){w.style.display="block",x.textContent="".concat(e," is the winner!!")}function K(e,t){var n=t.getGameBoard(),r=t.getMissedAttacksArray();n.forEach((function(t,n){t.forEach((function(t,r){if(t.shipName)if(1==t.shipName.checkHit(t.shipName.getShip()[t.shipIndex])){var a=document.querySelector(".".concat(e,' [data-x="').concat(r,'"][data-y ="').concat(n,'"]'));a.textContent="X",a.classList.add("hit"),a.classList.remove("occupied")}else 0==t.shipName.checkHit(t.shipName.getShip()[t.shipIndex])&&"playerBoard"==e&&document.querySelector(".".concat(e,' [data-x="').concat(r,'"][data-y ="').concat(n,'"]')).classList.add("occupied")}))})),r.forEach((function(t){var n=document.querySelector(".".concat(e,' [data-x="').concat(t.x,'"][data-y ="').concat(t.y,'"]'));n.textContent="X",n.classList.add("missed")}))}G(f),G(d),G(y),G(p),G(m),D(C),D(T),D(L),D(O),D(j),X("playerBoard"),X("aiBoard"),K("playerBoard",M),K("aiBoard",R),b.addEventListener("submit",(function(e){e.preventDefault();var t=S.value||"Player 1";V.setName(t),A.textContent="".concat(V.getName(),"'s Board"),k.style.display="none"})),B.addEventListener("click",(function(){location.reload()}))})();